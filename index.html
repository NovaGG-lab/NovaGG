<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    sendEmailVerification,
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    serverTimestamp,
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyAzJdwswNquD0j1HrM-UzlfRr59q4KUxx4",
  authDomain: "novagg-5bd3a.firebaseapp.com",
  projectId: "novagg-5bd3a",
  storageBucket: "novagg-5bd3a.firebasestorage.app",
  messagingSenderId: "672962665712",
  appId: "1:672962665712:web:4ed2f4a3c858ef9beeb635",
  measurementId: "G-0P30E7HKZN"
};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const form = document.getElementById("registerForm");
  const status = document.getElementById("statusMessage");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const username = document.getElementById("username").value;
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
      console.log("Creating user...");
      const userCredential = await createUserWithEmailAndPassword(
        auth,
        email,
        password
      );
      const user = userCredential.user;
      console.log("User created:", user.uid);

      try {
        console.log("Writing user data to Firestore...");
        await setDoc(doc(db, "users", user.uid), {
          username,
          email,
          createdAt: serverTimestamp(),
        });
        console.log("User data saved.");
      } catch (firestoreError) {
        console.error("Firestore write error:", firestoreError);
        status.textContent =
          "Error saving user data: " + firestoreError.message;
        status.style.color = "#f00";
        return; // stop if Firestore write fails
      }

      console.log("Sending verification email...");
      await sendEmailVerification(user);
      console.log("Verification email sent!");
      status.textContent = "Success! Check your email to verify your account.";
      status.style.color = "#0f0";
    } catch (err) {
      console.error("Registration error:", err);
      status.textContent = "Error: " + err.message;
      status.style.color = "#f00";
    }
  });
</script>
